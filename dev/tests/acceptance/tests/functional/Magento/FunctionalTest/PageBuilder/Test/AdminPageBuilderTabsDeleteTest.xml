<?xml version="1.0" encoding="UTF-8"?>
<!--
 /**
  * Copyright Â© Magento, Inc. All rights reserved.
  * See COPYING.txt for license details.
  */
-->

<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="../../../../../../vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Test/etc/testSchema.xsd">
    <test name="TabsRemoveLastTabByDeletingTabsBlock">
        <annotations>
            <features value="PageBuilder"/>
            <stories value="Tabs: Delete Tab From Tabs"/>
            <useCaseId value="MAGETWO-87052"/>
            <title value="Tabs Remove Last Tab Only By Deleting Tabs content block"/>
            <description value="A user should be able to remove tabs block from a row with confirmation."/>
            <severity value="CRITICAL"/>
            <testCaseId value="MAGETWO-90676"/>
            <group value="pagebuilder"/>
            <group value="pagebuilder-tabs"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <actionGroup ref="enablePageBuilderSetting" stepKey="turnOnPageBuilder"/>
            <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
            <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
        </before>
        <after>
            <actionGroup ref="DisabledWYSIWYG" stepKey="disableWYSIWYG"/>
            <amOnPage url="admin/admin/auth/logout" stepKey="amOnLogoutPage"/>
            <waitForPageLoad stepKey="waitForAdminLoginPageLoad"/>
        </after>
        <comment userInput="Given I have added Tabs container with one Tab to the stage and save" stepKey="AC1"/>
        <!-- Set the page title, as we'll be saving the page -->
        <actionGroup ref="addPageBuilderPageTitle" stepKey="enterPageTitle1">
            <argument name="contentBlockType" value="PageBuilderTabsContentBlock"/>
        </actionGroup>

        <fillField selector="{{PageBuilderActionsSection.searchPanel}}" userInput="tabs" stepKey="fillSearch"/>
        <see userInput="Tabs" selector="{{PageBuilderActionsSection.searchResults}}" stepKey="validateSearchResults"/>
        <actionGroup ref="dragContentBlockToStage" stepKey="dragContentBlockToStage">
            <argument name="contentBlockType" value="PageBuilderTabsContentBlock"/>
        </actionGroup>

        <waitForPageLoad stepKey="waitForTabsToLoad"/>
        <waitForElementVisible selector="{{TabOnStage.tabContent('1')}}" stepKey="waitForFirstTabContent"/>
        <waitForElementVisible selector="{{TabOnStage.tabHeader('1')}}" stepKey="waitForFirstTabHeader"/>
        <actionGroup ref="saveAndContinueEditCmsPage" stepKey="saveAndContinueEditCmsPage"/>
        <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>

        <comment userInput="When I view options menu for single Tab" stepKey="AC2"/>
        <waitForElementVisible time="10" selector="{{TabOnStage.tabHeader('1')}}" stepKey="waitForContentBlockInStageVisible" />
        <click stepKey="clickTabTitle" selector="{{TabOnStage.tabHeader('1')}}"/>
        <waitForElementVisible selector="{{TabOnStage.tabOptionsEdit}}" stepKey="seeTabOptionsEdit"/>

        <!-- Verify Remove option is disabled -->
        <comment userInput="User sees that removing last tab from the Tabs content block is disabled" stepKey="AC3"/>
        <seeElement selector="{{TabOnStage.tabOptionsRemoveDisabled}}" stepKey="seeTabRemoveOptionDisabled"/>
        <comment userInput="User remove default state Tabs block with confirmation." stepKey="AC4"/>
        <click selector="{{TabsOnStage.tabsContainer}}" stepKey="focusTabsElement"/>
        <actionGroup ref="removeContentBlockFromStage" stepKey="removeContentBlockFromStage">
            <argument name="contentBlockType" value="PageBuilderTabsContentBlock"/>
        </actionGroup>
        <actionGroup ref="saveAndContinueEditCmsPage" stepKey="saveAndContinueEditCmsPage2"/>

        <comment userInput="No Tabs shown on the stage after save nor on the storefront" stepKey="AC5"/>
        <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage2"/>
        <dontSeeElement selector="{{PageBuilderActionsSection.contentBlockInStage(PageBuilderTabsContentBlock.role)}}" stepKey="dontSeeContentBlockInStage"/>
        <amOnPage url="{{PageBuilderTabsContentBlock.name}}{{PageBuilderPageTitle.pageName}}" stepKey="amOnPageBuilderPage"/>
        <reloadPage stepKey="reloadPage"/>
        <waitForPageLoad stepKey="waitForStoreFrontPageLoad" time="30"/>
        <dontSeeElement selector="{{TabOnStorefront.tabHeader('1')}}" stepKey="noTabsOnStorefront"/>
    </test>
    <test name="TabsRemoveSecondTabDefaultState">
        <annotations>
            <features value="PageBuilder"/>
            <stories value="Tabs: Delete Tab From Tabs"/>
            <useCaseId value="MAGETWO-87052"/>
            <testCaseId value="MAGETWO-90672"/>
            <title value="Tabs Remove Individual Default State Second Tab"/>
            <description value="A user should be able to delete second tab in default state without confirmation modal."/>
            <severity value="CRITICAL"/>
            <group value="pagebuilder"/>
            <group value="pagebuilder-tabs"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <actionGroup ref="enablePageBuilderSetting" stepKey="turnOnPageBuilder"/>
            <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
            <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
        </before>
        <after>
            <actionGroup ref="DisabledWYSIWYG" stepKey="disableWYSIWYG"/>
            <actionGroup ref="logout" stepKey="logout"/>
        </after>
        <comment userInput="Given I have added Tabs content block to the stage with a second Tab in default state" stepKey="AC1"/>
        <!-- Set the page title, as we'll be saving the page -->
        <actionGroup ref="addPageBuilderPageTitle" stepKey="enterPageTitle1">
            <argument name="contentBlockType" value="PageBuilderTabsContentBlock"/>
        </actionGroup>

        <!-- Add Tabs to Stage -->
        <click selector="{{PageBuilderActionsSection.interactiveGroup}}" stepKey="clickInteractiveGroup"/>
        <actionGroup ref="dragContentBlockToStage" stepKey="dragTabsIntoStage">
            <argument name="contentBlockType" value="PageBuilderTabsContentBlock"/>
        </actionGroup>
        <!-- Validate Tabs default state On Stage -->
        <waitForPageLoad stepKey="waitForTabsToLoad"/>
        <waitForElementVisible selector="{{TabOnStage.tabContent('1')}}" stepKey="waitForFirstTabContent"/>
        <waitForElementVisible selector="{{TabOnStage.tabHeader('1')}}" stepKey="waitForFirstTabHeader"/>
        <click selector="{{TabsOnStage.tabsContainer}}" stepKey="focusTabsElement"/>
        <!-- Add second tab -->
        <actionGroup ref="addTab" stepKey="addSecondTab"/>
        <waitForPageLoad stepKey="waitForLoadingMaskToDisappear"/>
        <waitForElementVisible selector="{{TabOnStage.tabHeader('2')}}" stepKey="confirmSecondTab"/>

        <comment userInput="When I delete second default state Tab from the stage" stepKey="AC2"/>
        <waitForElementVisible time="10" selector="{{TabOnStage.tabHeader('2')}}" stepKey="waitForContentBlockInStageVisible" />
        <click stepKey="clickTabTitle" selector="{{TabOnStage.tabHeader('2')}}"/>
        <waitForElementVisible selector="{{TabOnStage.tabOptionsEdit}}" stepKey="seeTabOptionsEdit"/>
        <!-- Remove second tab -->
        <click selector="{{TabOnStage.tabOptionsRemove}}" stepKey="clickRemoveOption"/>
        <comment userInput="Removal confirmation modal not displayed when removing default state individual Tab" stepKey="AC3"/>

        <dontSee selector="{{PageBuilderActionsSection.modal}}" stepKey="dontSeeModalHeader"/>
        <dontSee selector="{{PageBuilderActionsSection.modalOk}}" stepKey="dontSeeModalOkHeader" />
        <comment userInput="Tabs with single Tab shown on the stage after save and on the storefront" stepKey="AC4"/>

        <actionGroup ref="saveAndContinueEditCmsPage" stepKey="saveAndContinueEditCmsPage"/>
        <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage2"/>
        <dontSeeElement selector="{{TabOnStage.tabHeader('2')}}" stepKey="dontSeeSecondTab"/>
        <seeElement selector="{{PageBuilderActionsSection.contentBlockInStage(PageBuilderTabsContentBlock.role)}}" stepKey="seeTabsInStage"/>
        <amOnPage url="{{PageBuilderTabsContentBlock.name}}{{PageBuilderPageTitle.pageName}}" stepKey="amOnPageBuilderPage"/>
        <reloadPage stepKey="reloadPage"/>
        <waitForPageLoad stepKey="waitForStoreFrontPageLoad" time="30"/>
        <dontSeeElement selector="{{TabOnStorefront.tabHeader('2')}}" stepKey="dontSeeSecondTabOnStorefront"/>
        <seeElement selector="{{TabOnStorefront.tabHeader('1')}}" stepKey="seeFirstTabOnStorefront"/>

    </test>
    <test name="TabsRemoveConfiguredSecondTabWithConfirmation">
        <annotations>
            <features value="PageBuilder"/>
            <stories value="Tabs: Delete Tab From Tabs"/>
            <useCaseId value="MAGETWO-87052"/>
            <testCaseId value="MAGETWO-90673"/>
            <title value="Tabs Remove Individual Configured Second Tab with Confirmation"/>
            <description value="A user should be able to delete second tab in configured state with confirmation modal."/>
            <severity value="CRITICAL"/>
            <group value="pagebuilder"/>
            <group value="pagebuilder-tabs"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <actionGroup ref="enablePageBuilderSetting" stepKey="turnOnPageBuilder"/>
            <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
            <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
        </before>
        <after>
            <actionGroup ref="DisabledWYSIWYG" stepKey="disableWYSIWYG"/>
            <actionGroup ref="logout" stepKey="logout"/>
        </after>
        <comment userInput="Given I have added a second Tab on the stage and customized it" stepKey="AC1"/>
        <!-- Add Tabs to Stage -->
        <click selector="{{PageBuilderActionsSection.interactiveGroup}}" stepKey="clickInteractiveGroup"/>
        <actionGroup ref="dragContentBlockToStage" stepKey="dragTabsIntoStage">
            <argument name="contentBlockType" value="PageBuilderTabsContentBlock"/>
        </actionGroup>
        <!-- Fill tab config-->
        <actionGroup ref="addTabAndOpenNewTabOptions" stepKey="addTabAndOpenNewTabOptions">
            <argument name="from" value="1"/>
            <argument name="to" value="2"/>
        </actionGroup>
        <actionGroup ref="fillSlideOutPanelFieldGeneral" stepKey="enterSecondTabName">
            <argument name="property" value="PageBuilderTabNameRandom2"/>
        </actionGroup>
        <actionGroup ref="selectSlideOutPanelField" stepKey="selectBackgroundPositionCentered">
            <argument name="property" value="PageBuilderTabBackgroundPositionCentered"/>
        </actionGroup>
        <actionGroup ref="selectSlideOutPanelField" stepKey="selectBackgroundAttachment">
            <argument name="property" value="PageBuilderTabBackgroundAttachmentFixed"/>
        </actionGroup>
        <actionGroup ref="fillSlideOutPanelFieldGeneral" stepKey="enterBackgroundColor">
            <argument name="property" value="PageBuilderTabBackgroundColorProperty"/>
        </actionGroup>
        <actionGroup ref="saveEditPanelSettings" stepKey="saveEditPanelSettings"/>

        <click stepKey="clickTabTitle" selector="{{TabOnStage.tabHeader('2')}}"/>
        <waitForElementVisible selector="{{TabOnStage.tabOptionsEdit}}" stepKey="seeTabOptionsEdit"/>
        <comment userInput="User deletes tab with customization from Tabs, user sees warning message" stepKey="AC2"/>
        <!-- Remove second tab -->
        <click selector="{{TabOnStage.tabOptionsRemove}}" stepKey="clickRemoveOption"/>
        <waitForElementVisible time="2" selector="{{PageBuilderActionsSection.modal}}" stepKey="waitForModalVisible"/>
        <comment userInput="User confirms deleting tab with customization, it disappears from Admin preview" stepKey="AC3"/>
        <actionGroup ref="confirmRemovalModal" stepKey="confirmRemoval"/>
        <dontSeeElement selector="{{TabOnStage.tabHeader('2')}}" stepKey="dontSeeSecondTab"/>
        <seeElement selector="{{TabOnStage.tabHeader('1')}}" stepKey="seeFirstTabOnStage"/>

    </test>
    <test name="TabsRemoveSecondTabContainingTextWithConfirmation">
        <annotations>
            <features value="PageBuilder"/>
            <stories value="Tabs: Delete Tab From Tabs"/>
            <useCaseId value="MAGETWO-87052"/>
            <testCaseId value="MAGETWO-90674"/>
            <title value="Tabs Remove Second Tab Containing Content with Confirmation"/>
            <description value="A user should be able to delete second tab that contains text content block with confirmation modal."/>
            <severity value="CRITICAL"/>
            <group value="pagebuilder"/>
            <group value="pagebuilder-tabs"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <actionGroup ref="EnabledWYSIWYG" stepKey="enableWYSIWYG"/>
            <actionGroup ref="enablePageBuilderSetting" stepKey="turnOnPageBuilder" after="enableWYSIWYG"/>
            <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
            <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
        </before>
        <after>
            <actionGroup ref="DisabledWYSIWYG" stepKey="disableWYSIWYG"/>
            <actionGroup ref="logout" stepKey="logout"/>
        </after>
        <comment userInput="Given I have added Tabs with a second Tab" stepKey="AC1"/>
        <!-- Set the page title, as we'll be saving the page -->
        <actionGroup ref="addPageBuilderPageTitle" stepKey="enterPageTitle1">
            <argument name="contentBlockType" value="PageBuilderTabsContentBlock"/>
        </actionGroup>
        <click selector="{{PageBuilderActionsSection.interactiveGroup}}" stepKey="clickInteractiveGroup"/>
        <actionGroup ref="dragContentBlockToStage" stepKey="dragTabsIntoStage">
            <argument name="contentBlockType" value="PageBuilderTabsContentBlock"/>
        </actionGroup>

        <actionGroup ref="addTab" stepKey="addSecondTab"/>
        <waitForPageLoad stepKey="waitForLoadingMaskToDisappear"/>
        <waitForElementVisible selector="{{TabOnStage.tabHeader('2')}}" stepKey="confirmSecondTab"/>
        <click selector="{{TabsOnStage.tabsContainer}}" stepKey="focusOnContentBlock"/>

        <comment userInput="Given I have added a Text content block to the second Tab" stepKey="AC2"/>
        <actionGroup ref="dragContentBlockToContainer" stepKey="dragTextOntoTab">
            <argument name="contentBlockType" value="PageBuilderTextContentBlock"/>
            <argument name="containerTargetType" value="PageBuilderTabContentBlock"/>
            <argument name="containerTargetIndex" value="1" />
        </actionGroup>

        <comment userInput="User deletes tab with content from Tabs, user sees warning message" stepKey="AC3"/>
        <click stepKey="clickTabTitle" selector="{{TabOnStage.tabHeader('2')}}"/>
        <waitForElementVisible selector="{{TabOnStage.tabOptionsEdit}}" stepKey="seeTabOptionsEdit"/>
        <click selector="{{TabOnStage.tabOptionsRemove}}" stepKey="clickRemoveOption"/>
        <waitForElementVisible time="2" selector="{{PageBuilderActionsSection.modal}}" stepKey="waitForModalVisible"/>
        <actionGroup ref="confirmRemovalModal" stepKey="confirmRemoval"/>
        <comment userInput="User confirms deleting tab with content, it disappears from Admin preview" stepKey="AC4"/>
        <dontSeeElement selector="{{TabOnStage.tabHeader('2')}}" stepKey="dontSeeSecondTab"/>
        <comment userInput="Tabs with single Tab shown on the stage after save" stepKey="AC5"/>

        <actionGroup ref="saveAndContinueEditCmsPage" stepKey="saveAndContinueEditCmsPage"/>
        <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage2"/>
        <dontSeeElement selector="{{TabOnStage.tabHeader('2')}}" stepKey="dontSeeSecondTab2"/>
        <seeElement selector="{{PageBuilderActionsSection.contentBlockInStage(PageBuilderTabsContentBlock.role)}}" stepKey="seeTabsInStage"/>
        <comment userInput="User goes to the storefront and sees 2 tabs not being displayed" stepKey="AC6"/>

        <amOnPage url="{{PageBuilderTabsContentBlock.name}}{{PageBuilderPageTitle.pageName}}" stepKey="amOnPageBuilderPage"/>
        <reloadPage stepKey="reloadPage"/>
        <waitForPageLoad stepKey="waitForStoreFrontPageLoad" time="30"/>
        <dontSeeElement selector="{{TabOnStage.tabHeader('2')}}" stepKey="dontSeeSecondTabOnStorefront"/>
        <seeElement selector="{{TabOnStage.tabHeader('1')}}" stepKey="seeFirstTabOnStorefront"/>
    </test>
    <test name="TabsRemoveConfiguredTabsContainerWithConfirmation">
        <annotations>
            <features value="PageBuilder"/>
            <stories value="Tabs: Delete Tab From Tabs"/>
            <useCaseId value="MAGETWO-87052"/>
            <testCaseId value="MAGETWO-90675"/>
            <title value="Tabs Remove Configured Tabs Container with Confirmation"/>
            <description value="A user should be able to delete a tabs container that has been customized with confirmation modal."/>
            <severity value="CRITICAL"/>
            <group value="pagebuilder"/>
            <group value="pagebuilder-tabs"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <actionGroup ref="enablePageBuilderSetting" stepKey="turnOnPageBuilder"/>
            <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
            <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
        </before>
        <after>
            <actionGroup ref="DisabledWYSIWYG" stepKey="disableWYSIWYG"/>
            <actionGroup ref="logout" stepKey="logout"/>
        </after>
        <comment userInput="Given I have customized the Edit Tabs container advanced settings" stepKey="AC1"/>
        <click selector="{{PageBuilderActionsSection.interactiveGroup}}" stepKey="clickInteractiveGroup"/>
        <actionGroup ref="dragContentBlockToStage" stepKey="dragTabsIntoStage">
            <argument name="contentBlockType" value="PageBuilderTabsContentBlock"/>
        </actionGroup>
        <click selector="{{TabsOnStage.tabsContainer}}" stepKey="focusTabsElement"/>
        <actionGroup ref="openPageBuilderEditPanel" stepKey="openEditMenuOnStage">
            <argument name="contentBlockType" value="PageBuilderTabsContentBlock"/>
        </actionGroup>
        <actionGroup ref="selectSlideOutPanelFieldGeneral" stepKey="enterNavAlignmentCenter">
            <argument name="property" value="PageBuilderTabsAlignmentCenter"/>
        </actionGroup>
        <actionGroup ref="saveEditPanelSettings" stepKey="saveEditPanelSettings"/>
        <!-- Verify in Admin Preview-->
        <waitForElementVisible selector="{{TabsOnStage.tabsNavAligned(PageBuilderTabsAlignmentCenter.value)}}" stepKey="seeTabsNavAlignedCenteredAdmin"/>
        <comment userInput="When I delete customized Tabs container from the stage" stepKey="AC2"/>
        <click selector="{{TabsOnStage.tabsContainer}}" stepKey="focusTabsElement2"/>
        <comment userInput="Removal confirmation modal displayed when removing customized Tabs container" stepKey="AC3"/>
        <actionGroup ref="removeContentBlockFromStage" stepKey="removeContentBlockFromStage">
            <argument name="contentBlockType" value="PageBuilderTabsContentBlock"/>
        </actionGroup>
    </test>
    <test name="TabsOnDeleteCorrectTabBecomesActiveAndFocused">
        <annotations>
            <features value="PageBuilder"/>
            <stories value="Tabs: Delete Tab From Tabs"/>
            <useCaseId value="MAGETWO-87052"/>
            <testCaseId value="MAGETWO-90677"/>
            <title value="Tabs Remove Third Tab And Second Becomes Active And Focused"/>
            <description value="A user should be able to delete a tab from tabs and next tab becomes active and focused."/>
            <severity value="CRITICAL"/>
            <group value="pagebuilder"/>
            <group value="pagebuilder-tabs"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <actionGroup ref="enablePageBuilderSetting" stepKey="turnOnPageBuilder"/>
            <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
            <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
        </before>
        <after>
            <actionGroup ref="DisabledWYSIWYG" stepKey="disableWYSIWYG"/>
            <actionGroup ref="logout" stepKey="logout"/>
        </after>
        <comment userInput="Given I have added Tabs container with 3 Tabs to the stage" stepKey="AC1"/>
        <click selector="{{PageBuilderActionsSection.interactiveGroup}}" stepKey="clickInteractiveGroup"/>
        <actionGroup ref="dragContentBlockToStage" stepKey="dragTabsIntoStage">
            <argument name="contentBlockType" value="PageBuilderTabsContentBlock"/>
        </actionGroup>
        <actionGroup ref="addTab" stepKey="addSecondTab"/>
        <waitForElementVisible selector="{{TabOnStage.tabContent('2')}}" stepKey="waitForNewTabContent2"/>
        <waitForElementVisible selector="{{TabOnStage.tabHeader('2')}}" stepKey="waitForNewTabHeader2"/>
        <actionGroup ref="addTab" stepKey="addThirdTab"/>
        <waitForElementVisible selector="{{TabOnStage.tabContent('3')}}" stepKey="waitForNewTabContent3"/>
        <waitForElementVisible selector="{{TabOnStage.tabHeader('3')}}" stepKey="waitForNewTabHeader3"/>
        <comment userInput="When I delete third Tab from the stage" stepKey="AC2"/>
        <click stepKey="clickTabHeader3" selector="{{TabOnStage.tabHeader('3')}}"/>
        <waitForElementVisible selector="{{TabOnStage.tabOptionsEdit}}" stepKey="seeTabOptionsEdit"/>
        <click selector="{{TabOnStage.tabOptionsRemove}}" stepKey="clickRemoveOption"/>
        <waitForPageLoad stepKey="waitForDeleteTab" />
        <dontSeeElement selector="{{TabOnStage.tabHeader('3')}}" stepKey="dontSeeThirdTabOnStorefront"/>
        <comment userInput="Second Tab becomes both active and focused" stepKey="AC3"/>
        <waitForPageLoad stepKey="waitForTabChangeAnimation" />
        <waitForElementVisible selector="{{TabOnStage.tabHeaderItemActive('2')}}" stepKey="seeTab2Active"/>
        <assertElementContainsAttribute selector="{{TabOnStage.tabPanel('1')}}" attribute="aria-hidden" expectedValue="true" stepKey="assertTab1Hidden"/>
        <assertElementContainsAttribute selector="{{TabOnStage.tabPanel('2')}}" attribute="aria-hidden" expectedValue="false" stepKey="assertTab2Visible"/>
    </test>
    <test name="TabsDismissedCustomizedTabRemovalConfirmationPersistsSession">
        <annotations>
            <features value="PageBuilder"/>
            <stories value="Tabs: Delete Tab From Tabs"/>
            <useCaseId value="MAGETWO-87052"/>
            <testCaseId value="MAGETWO-90671"/>
            <title value="Tabs Dismissed Customized Tab Removal Confirmation Persists Session"/>
            <description value="A user should be able to dismiss confirmation modal on Tab and not receive the modal for the rest of the session"/>
            <severity value="CRITICAL"/>
            <group value="pagebuilder"/>
            <group value="pagebuilder-tabs"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <actionGroup ref="enablePageBuilderSetting" stepKey="turnOnPageBuilder"/>
            <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
            <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
        </before>
        <after>
            <actionGroup ref="DisabledWYSIWYG" stepKey="disableWYSIWYG"/>
            <actionGroup ref="logout" stepKey="logout"/>
        </after>
        <comment userInput="Given I have customized a Tab on the stage and copied it" stepKey="AC1"/>
        <!-- Set the page title, as we'll be saving the page -->
        <actionGroup ref="addPageBuilderPageTitle" stepKey="enterPageTitle1">
            <argument name="contentBlockType" value="PageBuilderTabsContentBlock"/>
        </actionGroup>
        <!-- Add Tabs to Stage -->
        <click selector="{{PageBuilderActionsSection.interactiveGroup}}" stepKey="clickInteractiveGroup"/>
        <actionGroup ref="dragContentBlockToStage" stepKey="dragTabsIntoStage">
            <argument name="contentBlockType" value="PageBuilderTabsContentBlock"/>
        </actionGroup>
        <waitForElementVisible selector="{{TabOnStage.tabOptionsEdit}}" stepKey="seeTabOptionsEdit1"/>
        <click selector="{{TabOnStage.tabOptionsEdit}}" stepKey="clickEditContentBlock"/>
        <actionGroup ref="fillSlideOutPanelFieldGeneral" stepKey="enterFirstTabName">
            <argument name="property" value="PageBuilderTabNameRandom1"/>
        </actionGroup>
        <actionGroup ref="fillSlideOutPanelFieldGeneral" stepKey="enterBackgroundColor">
            <argument name="property" value="PageBuilderTabBackgroundColorProperty"/>
        </actionGroup>
        <actionGroup ref="saveEditPanelSettings" stepKey="saveEditPanelSettings"/>
        <waitForPageLoad stepKey="waitForNewTab" time="30"/>

        <actionGroup ref="duplicateTabByIndex" stepKey="duplicateTabByIndex1">
            <argument name="index" value="1"/>
        </actionGroup>
        <actionGroup ref="duplicateTabByIndex" stepKey="duplicateTabByIndex2">
            <argument name="index" value="2"/>
        </actionGroup>
        <comment userInput="When I delete customized Tab from the stage and dismiss the warning on confirmation modal" stepKey="AC2"/>
        <click stepKey="clickTabHeader3" selector="{{TabOnStage.tabHeader('3')}}"/>
        <waitForElementVisible selector="{{TabOnStage.tabOptionsEdit}}" stepKey="seeTabOptionsEdit2"/>
        <click selector="{{TabOnStage.tabOptionsRemove}}" stepKey="clickRemoveOption"/>
        <waitForPageLoad stepKey="waitForDeleteTab3" time="30"/>
        <waitForElementVisible time="10" selector="{{PageBuilderActionsSection.modal}}" stepKey="waitForModalVisible"/>
        <seeElementInDOM selector="{{PageBuilderActionsSection.modal}}" stepKey="seeModal"/>
        <seeElementInDOM selector="{{PageBuilderActionsSection.modalOk}}" stepKey="seeModalOk" />
        <waitForElementVisible selector="{{PageBuilderActionsSection.modalDoNotShowThisAgain}}" stepKey="waitForDoNotShowThisAgain"/>
        <click selector="{{PageBuilderActionsSection.modalDoNotShowThisAgain}}" stepKey="clickDoNotShowThisAgain"/>
        <actionGroup ref="confirmRemovalModal" stepKey="confirmRemoval"/>
        <waitForPageLoad stepKey="waitForRemovalModal" time="30"/>
        <dontSeeElement selector="{{TabOnStage.tabHeader('3')}}" stepKey="dontSeeThirdTab"/>

        <comment userInput="Deleting another customized Tab from the stage does not show confirmation modal" stepKey="AC3"/>
        <click stepKey="clickTabHeader2" selector="{{TabOnStage.tabHeader('2')}}"/>
        <waitForElementVisible selector="{{TabOnStage.tabOptionsEdit}}" stepKey="seeTabOptionsEdit3"/>
        <click selector="{{TabOnStage.tabOptionsRemove}}" stepKey="clickRemoveOption2"/>
        <waitForPageLoad stepKey="waitForDeleteTab2" time="30"/>
        <dontSee selector="{{PageBuilderActionsSection.modal}}" stepKey="dontSeeModalHeader"/>
        <dontSee selector="{{PageBuilderActionsSection.modalOk}}" stepKey="dontSeeModalOkHeader" />
        <dontSeeElement selector="{{TabOnStage.tabHeader('2')}}" stepKey="dontSeeSecondTabOnStage"/>

        <comment userInput="Deleting a customized Heading from the stage does not show confirmation modal in same session" stepKey="AC4"/>
        <actionGroup ref="dragContentBlockToStage" stepKey="dragRowIntoStage">
            <argument name="contentBlockType" value="PageBuilderRowContentBlock"/>
        </actionGroup>
        <seeNumberOfElements selector="{{RowOnStage.allRows}}" userInput="2" stepKey="seeTwoRows"/>
        <actionGroup ref="dragContentBlockToContainer" stepKey="dragHeadingOntoNewRow">
            <argument name="contentBlockType" value="PageBuilderHeadingContentBlock"/>
            <argument name="containerTargetType" value="PageBuilderRowContentBlock"/>
            <argument name="containerTargetIndex" value="1" />
        </actionGroup>

        <!-- Configure our heading -->
        <actionGroup ref="openPageBuilderEditPanel" stepKey="openEditMenuOnStage">
            <argument name="contentBlockType" value="PageBuilderHeadingContentBlock"/>
        </actionGroup>
        <actionGroup ref="selectSlideOutPanelFieldGeneral" stepKey="enterHeadingTypePropertyH5">
            <argument name="property" value="PageBuilderHeadingTypeProperty_H5"/>
        </actionGroup>
        <actionGroup ref="fillSlideOutPanelFieldGeneral" stepKey="enterHeadingTitleProperty">
            <argument name="property" value="PageBuilderHeadingTextProperty"/>
        </actionGroup>
        <actionGroup ref="saveEditPanelSettings" stepKey="saveEditPanelSettingsHeading"/>

        <!-- Remove the heading, should not see modal -->
        <actionGroup ref="removeEmptyContentBlockFromStage" stepKey="removeHeader">
            <argument name="contentBlockType" value="PageBuilderHeadingContentBlock"/>
        </actionGroup>
        <dontSee selector="{{PageBuilderActionsSection.modal}}" stepKey="dontSeeModalHeaderAfterHeader"/>
        <dontSee selector="{{PageBuilderActionsSection.modalOk}}" stepKey="dontSeeModalOkHeaderAfterHeader" />

        <!-- Validate the items are removed -->
        <dontSeeElement selector="{{PageBuilderActionsSection.contentBlockInStage(PageBuilderHeadingContentBlock.role)}}" stepKey="dontSeeHeaderInStage"/>

    </test>
</tests>
