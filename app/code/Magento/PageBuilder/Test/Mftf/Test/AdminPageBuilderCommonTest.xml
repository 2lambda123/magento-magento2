<?xml version="1.0" encoding="UTF-8"?>
<!--
 /**
  * Copyright Â© Magento, Inc. All rights reserved.
  * See COPYING.txt for license details.
  */
-->

<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="../../../../../../../dev/tests/acceptance/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Test/etc/testSchema.xsd">
    <test name="DefaultSystemBordersAppearInAdmin">
        <annotations>
            <features value="Pagebuilder"/>
            <stories value="MAGETWO-66176: Bluefoot Column Configuration "/>
            <title value="System Borders Default Style in Admin"/>
            <description value="A user should be able to see default system borders for all content types in admin preview"/>
            <severity value="CRITICAL"/>
            <testCaseId value="MC-2382"/>
            <group value="pagebuilder"/>
            <group value="pagebuilder-common"/>
            <group value="pagebuilder-heading"/>
            <!-- MAGETWO-91028 -->
            <group value="skip"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
            <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
        </before>
        <after>
            <actionGroup ref="logout" stepKey="logout"/>
        </after>
        <!-- Add all content types to stage-->
        <actionGroup ref="dragContentTypeToStage" stepKey="dragTextIntoStage">
            <argument name="contentType" value="PageBuilderTextContentType"/>
        </actionGroup>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragButtonsIntoStage">
            <argument name="contentType" value="PageBuilderButtonsContentType"/>
        </actionGroup>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragHeaderIntoStage">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <actionGroup ref="clickOutsideLiveEditHeading" stepKey="clickOutsideLiveEditHeading">
            <argument name="index" value="1"/>
        </actionGroup>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragDividerIntoStage">
            <argument name="contentType" value="PageBuilderDividerContentType"/>
        </actionGroup>
        <click selector="{{PageBuilderPanel.mediaGroup}}" stepKey="clickMediaGroup"/>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragImageIntoStage">
            <argument name="contentType" value="PageBuilderImageContentType"/>
        </actionGroup>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragBannerIntoStage">
            <argument name="contentType" value="PageBuilderBannerContentType"/>
        </actionGroup>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragVideoIntoStage">
            <argument name="contentType" value="PageBuilderVideoContentType"/>
        </actionGroup>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragSliderIntoStage">
            <argument name="contentType" value="PageBuilderSliderContentType"/>
        </actionGroup>
        <click selector="{{PageBuilderPanel.interactiveGroup}}" stepKey="clickInteractiveGroup"/>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragTabsIntoStage">
            <argument name="contentType" value="PageBuilderTabsContentType"/>
        </actionGroup>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragAccordionIntoStage">
            <argument name="contentType" value="PageBuilderAccordionContentType"/>
        </actionGroup>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragMapIntoStage">
            <argument name="contentType" value="PageBuilderMapContentType"/>
        </actionGroup>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragNewsletterIntoStage">
            <argument name="contentType" value="PageBuilderNewsletterContentType"/>
        </actionGroup>
        <click selector="{{PageBuilderPanel.magentoGroup}}" stepKey="clickMagentoGroup"/>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragBlockIntoStage">
            <argument name="contentType" value="PageBuilderBlockContentType"/>
        </actionGroup>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragProductIntoStage">
            <argument name="contentType" value="PageBuilderProductsContentType"/>
        </actionGroup>
        <click selector="{{PageBuilderPanel.otherGroup}}" stepKey="clickOtherGroup"/>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragAnchorIntoStage">
            <argument name="contentType" value="PageBuilderAnchorContentType"/>
        </actionGroup>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragHtmlIntoStage">
            <argument name="contentType" value="PageBuilderHtmlContentType"/>
        </actionGroup>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragColumnIntoStage">
            <argument name="contentType" value="PageBuilderColumnContentType"/>
        </actionGroup>
        <!-- See row and column system border on default - Depends on MQE-818 -->
        <executeJS function="window.getComputedStyle(document.querySelector('.pagebuilder-row'),null).getPropertyValue('outline')" stepKey="getDefaultRowOutlineStyle"/>
        <assertEquals expected="rgba(153, 153, 153, 0.3) solid 1px" expectedType="string" actual="getDefaultRowOutlineStyle" actualType="variable" message="pass" stepKey="assertDefaultRowOutlineStyle"/>
    </test>
    <test name="NoConfirmationOnDefaultStateContentTypeRemoval">
        <annotations>
            <features value="Pagebuilder"/>
            <stories value="MAGETWO-86799: Deleting Content type/ container from the stage"/>
            <title value="No confirmation when removing an empty content type"/>
            <description value="A user should not be prompt when removing a content type in its default state with no children"/>
            <severity value="CRITICAL"/>
            <testCaseId value="MAGETWO-89052"/>
            <group value="pagebuilder"/>
            <group value="pagebuilder-common"/>
            <group value="pagebuilder-heading"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
            <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
        </before>
        <after>
            <actionGroup ref="logout" stepKey="logout"/>
        </after>
        <!-- Add a single header into the first row -->
        <actionGroup ref="dragContentTypeToStage" stepKey="dragHeaderIntoStage">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <actionGroup ref="clickOutsideLiveEditHeading" stepKey="clickOutsideLiveEditHeading">
            <argument name="index" value="1"/>
        </actionGroup>
        <!-- Add an additional row to attempt removal of a row -->
        <actionGroup ref="dragContentTypeToStageByIndex" stepKey="dragRowIntoStage">
            <argument name="contentType" value="PageBuilderRowContentType"/>
            <argument name="contentTypeNumber" value="2"/>
        </actionGroup>

        <!-- Attempt to remove both content types validating the confirmation window is never displayed -->
        <actionGroup ref="removeEmptyContentTypeFromStage" stepKey="removeHeader">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <dontSee selector="{{PageBuilderStage.modal}}" stepKey="dontSeeModalHeader"/>
        <dontSee selector="{{PageBuilderStage.modalOk}}" stepKey="dontSeeModalOkHeader" />
        <actionGroup ref="removeEmptyContentTypeFromStage" stepKey="removeRow">
            <argument name="contentType" value="PageBuilderRowContentType"/>
        </actionGroup>
        <dontSee selector="{{PageBuilderStage.modal}}" stepKey="dontSeeModalRow"/>
        <dontSee selector="{{PageBuilderStage.modalOk}}" stepKey="dontSeeModalOkRow" />
    </test>
    <test name="ConfirmationOnContainerWithChildrenRemoval">
        <annotations>
            <features value="Pagebuilder"/>
            <stories value="MAGETWO-86799: Deleting Content type/ container from the stage"/>
            <title value="Removal confirmation on container content type with children"/>
            <description value="The user should be prompted when removing a content type which has children"/>
            <severity value="CRITICAL"/>
            <testCaseId value="MAGETWO-89053"/>
            <group value="pagebuilder"/>
            <group value="pagebuilder-common"/>
            <group value="pagebuilder-heading"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
            <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
        </before>
        <after>
            <actionGroup ref="logout" stepKey="logout"/>
        </after>
        <!-- Add a single header into the first row -->
        <actionGroup ref="dragContentTypeToStage" stepKey="dragHeaderIntoStage">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <actionGroup ref="clickOutsideLiveEditHeading" stepKey="clickOutsideLiveEditHeading">
            <argument name="index" value="1"/>
        </actionGroup>
        <!-- Add an additional row so we're able to delete the first one -->
        <actionGroup ref="dragContentTypeToStageByIndex" stepKey="dragRowIntoStage">
            <argument name="contentType" value="PageBuilderRowContentType"/>
            <argument name="contentTypeNumber" value="2"/>
        </actionGroup>
        <!-- Remove second row now containing heading -->
        <actionGroup ref="removeContentTypeFromStageByIndex" stepKey="removeSecondRow">
            <argument name="contentType" value="PageBuilderRowContentType"/>
            <argument name="contentTypeNumber" value="2"/>
            <argument name="x" value="10"/>
            <argument name="y" value="0"/>
        </actionGroup>
        <!-- As the row now contains a header it should prompt on removal -->
        <waitForElementVisible time="10" selector="{{PageBuilderStage.modal}}" stepKey="waitForModalVisible"/>
        <seeElementInDOM selector="{{PageBuilderStage.modal}}" stepKey="seeModal"/>
        <seeElementInDOM selector="{{PageBuilderStage.modalOk}}" stepKey="seeModalOk" />

        <!-- Confirm removal of the row -->
        <actionGroup ref="confirmRemovalModal" stepKey="confirmRemoval"/>
        <wait time="2" stepKey="waitForRemovalModal" />

        <!-- Validate the item is removed -->
        <seeNumberOfElements selector="{{RowOnStage.allRows}}" userInput="1" stepKey="seeElementRow"/>
    </test>
    <test name="ConfirmationOnConfiguredContentTypeRemoval">
        <annotations>
            <features value="Pagebuilder"/>
            <stories value="MAGETWO-86799: Deleting Content type/ container from the stage"/>
            <title value="Removal confirmation on normal content type"/>
            <description value="The user should be prompted when removing a content type which has had data modified within"/>
            <severity value="CRITICAL"/>
            <testCaseId value="MAGETWO-89054"/>
            <group value="pagebuilder"/>
            <group value="pagebuilder-common"/>
            <group value="pagebuilder-heading"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
            <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
        </before>
        <after>
            <actionGroup ref="logout" stepKey="logout"/>
        </after>
        <!-- Add a single header into the first row -->
        <actionGroup ref="dragContentTypeToStage" stepKey="dragHeaderIntoStage">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <actionGroup ref="clickOutsideLiveEditHeading" stepKey="clickOutsideLiveEditHeading">
            <argument name="index" value="1"/>
        </actionGroup>
        <!-- Configure our heading -->
        <actionGroup ref="openPageBuilderEditPanel" stepKey="openEditMenuOnStage">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <actionGroup ref="selectSlideOutPanelFieldGeneral" stepKey="enterHeadingTypePropertyH5">
            <argument name="property" value="PageBuilderHeadingTypeProperty_H5"/>
        </actionGroup>
        <actionGroup ref="fillSlideOutPanelFieldGeneral" stepKey="enterHeadingTitleProperty">
            <argument name="property" value="PageBuilderHeadingTextProperty"/>
        </actionGroup>
        <actionGroup ref="saveEditPanelSettings" stepKey="saveEditPanelSettings"/>

        <!-- As the header has configuration data it should not prompt for removal -->
        <actionGroup ref="removeEmptyContentTypeFromStage" stepKey="removeHeader">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <waitForElementVisible time="2" selector="{{PageBuilderStage.modal}}" stepKey="waitForModalVisible"/>
        <seeElementInDOM selector="{{PageBuilderStage.modal}}" stepKey="seeModal"/>
        <seeElementInDOM selector="{{PageBuilderStage.modalOk}}" stepKey="seeModalOk" />

        <!-- Confirm removal of the header -->
        <actionGroup ref="confirmRemovalModal" stepKey="confirmRemoval"/>
        <wait time="2" stepKey="waitForRemovalModal" />

        <!-- Validate the item is removed -->
        <dontSeeElement selector="{{PageBuilderStage.contentTypeInStage(PageBuilderHeadingContentType.role)}}" stepKey="dontSeeHeaderInStage"/>
    </test>
    <test name="NoRemovalConfirmationModalAfterConfiguringContentToDefaultState">
        <annotations>
            <features value="Pagebuilder"/>
            <stories value="Removal Confirmation Modal"/>
            <title value="Verify No Removal Confirmation Modal After Configuring Content Back To Default State"/>
            <description value="The user should not see a removal confirmation modal if they reconfigure their content to match default state"/>
            <severity value="CRITICAL"/>
            <useCaseId value="MAGETWO-87059"/>
            <testCaseId value="MAGETWO-91322"/>
            <group value="pagebuilder"/>
            <group value="pagebuilder-common"/>
            <group value="pagebuilder-heading"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
            <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
        </before>
        <after>
            <actionGroup ref="logout" stepKey="logout"/>
        </after>
        <!-- Add 2nd Row and Heading-->
        <comment userInput="2nd Row and Heading" stepKey="commentAdd"/>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragContentTypeToStage1">
            <argument name="contentType" value="PageBuilderRowContentType"/>
        </actionGroup>
        <actionGroup ref="dragContentTypeToContainer" stepKey="dragContentTypeToStage2">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
            <argument name="containerTargetType" value="PageBuilderRowContentType"/>
            <argument name="containerTargetIndex" value="2"/>
        </actionGroup>
        <scrollTo selector="div.pagebuilder-header" x="0" y="-100" stepKey="scrollToTop"/>
        <actionGroup ref="clickOutsideLiveEditHeading" stepKey="clickOutsideLiveEditHeading">
            <argument name="index" value="1"/>
        </actionGroup>
        <!-- Configure Heading -->
        <comment userInput="Configure Heading" stepKey="commentEditHeading1"/>
        <actionGroup ref="openPageBuilderEditPanel" stepKey="openEditMenuOnStage">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <actionGroup ref="fillSlideOutPanelFieldGeneral" stepKey="enterHeadingTitleProperty">
            <argument name="property" value="PageBuilderHeadingTextProperty"/>
        </actionGroup>
        <actionGroup ref="saveEditPanelSettings" stepKey="saveEditPanelSettings"/>
        <waitForElementVisible selector="{{HeadingOnStage.base(PageBuilderHeadingTypeProperty_H2.value, '1')}}" stepKey="validateHeading1"/>
        <!-- Configure Heading Back To Default -->
        <comment userInput="Configure Heading Back To Default" stepKey="commentEditHeading2"/>
        <actionGroup ref="openPageBuilderEditPanel" stepKey="openEditMenuOnStage2">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <actionGroup ref="fillSlideOutPanelFieldGeneral" stepKey="enterHeadingTitle2">
            <argument name="property" value="PageBuilderHeadingTextDefaultProperty"/>
        </actionGroup>
        <actionGroup ref="saveEditPanelSettings" stepKey="saveEditPanelSettings2"/>
        <!-- Remove Heading -->
        <comment userInput="Remove Heading" stepKey="commentRemoveHeading"/>
        <actionGroup ref="removeEmptyContentTypeFromStage" stepKey="removeHeading">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <!-- Verify No Modal 1 -->
        <comment userInput="Verify No Modal 1" stepKey="commentNoModal1"/>
        <waitForPageLoad stepKey="waitForPageLoad1"/>
        <dontSee selector="{{PageBuilderStage.modal}}" stepKey="dontSeeModalHeading"/>
        <dontSee selector="{{PageBuilderStage.modalOk}}" stepKey="dontSeeModalOkHeading"/>
        <seeNumberOfElements selector="{{RowOnStage.allRows}}" userInput="2" stepKey="seeRows1"/>
        <!-- Remove Parent Row -->
        <comment userInput="Remove Parent Row" stepKey="commentRemoveRow"/>
        <actionGroup ref="removeContentTypeFromStageByIndex" stepKey="removeRow">
            <argument name="contentType" value="PageBuilderRowContentType"/>
            <argument name="contentTypeNumber" value="2"/>
        </actionGroup>
        <!-- Verify No Modal 2 -->
        <comment userInput="Verify No Modal 2" stepKey="commentNoModal2"/>
        <waitForPageLoad stepKey="waitForPageLoad2"/>
        <dontSee selector="{{PageBuilderStage.modal}}" stepKey="dontSeeModalRow"/>
        <dontSee selector="{{PageBuilderStage.modalOk}}" stepKey="dontSeeModalOkRow"/>
        <seeNumberOfElements selector="{{RowOnStage.allRows}}" userInput="1" stepKey="seeRows2"/>
    </test>
    <test name="DismissRemovalConfirmationModal">
        <annotations>
            <features value="Pagebuilder"/>
            <stories value="MAGETWO-86799: Deleting Content type/ container from the stage"/>
            <title value="Dismissing the removal confirmation modal"/>
            <description value="The user should not be prompted after selecting 'Do not show this again'"/>
            <severity value="CRITICAL"/>
            <testCaseId value="MAGETWO-89055"/>
            <group value="pagebuilder"/>
            <group value="pagebuilder-common"/>
            <group value="pagebuilder-heading"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
            <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
        </before>
        <after>
            <actionGroup ref="logout" stepKey="logout"/>
        </after>
        <!-- Add a single header into the first row -->
        <actionGroup ref="dragContentTypeToStage" stepKey="dragHeaderIntoStage">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <actionGroup ref="clickOutsideLiveEditHeading" stepKey="clickOutsideLiveEditHeading">
            <argument name="index" value="1"/>
        </actionGroup>
        <!-- Configure our heading -->
        <actionGroup ref="openPageBuilderEditPanel" stepKey="openEditMenuOnStage">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <actionGroup ref="selectSlideOutPanelFieldGeneral" stepKey="enterHeadingTypePropertyH5">
            <argument name="property" value="PageBuilderHeadingTypeProperty_H5"/>
        </actionGroup>
        <actionGroup ref="fillSlideOutPanelFieldGeneral" stepKey="enterHeadingTitleProperty">
            <argument name="property" value="PageBuilderHeadingTextProperty"/>
        </actionGroup>
        <actionGroup ref="saveEditPanelSettings" stepKey="saveEditPanelSettings"/>

        <!-- Duplicate heading -->
        <actionGroup ref="duplicateContentType" stepKey="duplicateHeadingOnce">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>

        <!-- Remove the first heading, expect a prompt -->
        <actionGroup ref="removeContentTypeFromStageByIndex" stepKey="removeFirstHeader">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
            <argument name="contentTypeNumber" value="1"/>
        </actionGroup>
        
        <waitForElementVisible time="2" selector="{{PageBuilderStage.modal}}" stepKey="waitForModalVisible"/>
        <seeElementInDOM selector="{{PageBuilderStage.modal}}" stepKey="seeModal"/>
        <seeElementInDOM selector="{{PageBuilderStage.modalOk}}" stepKey="seeModalOk" />
        <waitForElementVisible selector="{{PageBuilderStage.modalDoNotShowThisAgain}}" stepKey="waitForDoNotShowThisAgain"/>
        <click selector="{{PageBuilderStage.modalDoNotShowThisAgain}}" stepKey="clickDoNotShowThisAgain"/>
        <actionGroup ref="confirmRemovalModal" stepKey="confirmRemoval"/>
        <wait time="2" stepKey="waitForRemovalModal" />

        <!-- Attempt to remove secondary heading, no modal should appear even though it's configured -->
        <actionGroup ref="removeEmptyContentTypeFromStage" stepKey="removeSecondHeader">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <dontSee selector="{{PageBuilderStage.modal}}" stepKey="dontSeeModalHeader"/>
        <dontSee selector="{{PageBuilderStage.modalOk}}" stepKey="dontSeeModalOkHeader" />

        <!-- Validate the items are removed -->
        <dontSeeElement selector="{{PageBuilderStage.contentTypeInStage(PageBuilderHeadingContentType.role)}}" stepKey="dontSeeHeaderInStage"/>
    </test>
    <test name="DismissedConfirmationPersistsSession">
        <annotations>
            <features value="Pagebuilder"/>
            <stories value="MAGETWO-86799: Deleting Content type/ container from the stage"/>
            <title value="Dismissed confirmation persists session"/>
            <description value="The user should not be prompted within the current session for removal"/>
            <severity value="CRITICAL"/>
            <testCaseId value="MAGETWO-89056"/>
            <group value="pagebuilder"/>
            <group value="pagebuilder-common"/>
            <group value="pagebuilder-heading"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
            <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
        </before>
        <after>
            <actionGroup ref="logout" stepKey="logout"/>
        </after>
        <!-- Set the page title, as we'll be saving the page -->
        <actionGroup ref="addPageBuilderPageTitle" stepKey="enterPageTitle1">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>

        <!-- Add a single header into the first row -->
        <actionGroup ref="dragContentTypeToStage" stepKey="dragHeaderIntoStage">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <actionGroup ref="clickOutsideLiveEditHeading" stepKey="clickOutsideLiveEditHeading">
            <argument name="index" value="1"/>
        </actionGroup>
        <!-- Configure our heading -->
        <actionGroup ref="openPageBuilderEditPanel" stepKey="openEditMenuOnStage">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <actionGroup ref="selectSlideOutPanelFieldGeneral" stepKey="enterHeadingTypePropertyH5">
            <argument name="property" value="PageBuilderHeadingTypeProperty_H5"/>
        </actionGroup>
        <actionGroup ref="fillSlideOutPanelFieldGeneral" stepKey="enterHeadingTitleProperty">
            <argument name="property" value="PageBuilderHeadingTextProperty"/>
        </actionGroup>
        <actionGroup ref="saveEditPanelSettings" stepKey="saveEditPanelSettings"/>

        <!-- Duplicate heading, we shall attempt to remove this after save -->
        <actionGroup ref="duplicateContentType" stepKey="duplicateHeadingOnce">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>

        <!-- Remove the first heading, check to not receive this warning again -->
        <actionGroup ref="removeEmptyContentTypeFromStage" stepKey="removeFirstHeader">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <waitForElementVisible time="2" selector="{{PageBuilderStage.modal}}" stepKey="waitForModalVisible"/>
        <seeElementInDOM selector="{{PageBuilderStage.modal}}" stepKey="seeModal"/>
        <seeElementInDOM selector="{{PageBuilderStage.modalOk}}" stepKey="seeModalOk" />
        <waitForElementVisible selector="{{PageBuilderStage.modalDoNotShowThisAgain}}" stepKey="waitForDoNotShowThisAgain"/>
        <click selector="{{PageBuilderStage.modalDoNotShowThisAgain}}" stepKey="clickDoNotShowThisAgain"/>
        <actionGroup ref="confirmRemovalModal" stepKey="confirmRemoval"/>

        <!-- Save the page -->
        <actionGroup ref="saveAndContinueEditCmsPage" stepKey="saveAndContinueEditCmsPage"/>
        <see userInput="{{PageBuilderPageTitle.pageName}}" selector="{{CmsNewPagePageActionsSection.cmsPageTitle}}" stepKey="assertTitleSavedCmsPage"/>
        <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>

        <!-- Attempt to remove secondary heading, no modal should appear even though it's configured -->
        <actionGroup ref="removeEmptyContentTypeFromStage" stepKey="removeSecondHeader">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <dontSee selector="{{PageBuilderStage.modal}}" stepKey="dontSeeModalHeader"/>
        <dontSee selector="{{PageBuilderStage.modalOk}}" stepKey="dontSeeModalOkHeader" />

        <!-- Validate the items are removed -->
        <dontSeeElement selector="{{PageBuilderStage.contentTypeInStage(PageBuilderHeadingContentType.role)}}" stepKey="dontSeeHeaderInStage"/>
    </test>
    <test name="CancelOnRemovalConfirmationModal">
        <annotations>
            <features value="Pagebuilder"/>
            <stories value="Removal Confirmation Modal"/>
            <title value="Cancel Removal Confirmation Modal"/>
            <description value="The user should be able to click cancel in removal confirmation modal and not have content removed."/>
            <severity value="CRITICAL"/>
            <useCaseId value="MAGETWO-87059"/>
            <testCaseId value="MAGETWO-91320"/>
            <group value="pagebuilder"/>
            <group value="pagebuilder-common"/>
            <group value="pagebuilder-heading"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
            <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
        </before>
        <after>
            <actionGroup ref="logout" stepKey="logout"/>
        </after>
        <!-- Add Heading -->
        <comment userInput="Add Heading" stepKey="commentAddHeading"/>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragContentTypeToStage">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <actionGroup ref="clickOutsideLiveEditHeading" stepKey="clickOutsideLiveEditHeading">
            <argument name="index" value="1"/>
        </actionGroup>
        <!-- Configure Heading -->
        <comment userInput="Configure Heading" stepKey="commentHeading"/>
        <actionGroup ref="openPageBuilderEditPanel" stepKey="openEditMenuOnStage">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <actionGroup ref="selectSlideOutPanelFieldGeneral" stepKey="enterHeadingType">
            <argument name="property" value="PageBuilderHeadingTypeProperty_H2"/>
        </actionGroup>
        <actionGroup ref="fillSlideOutPanelFieldGeneral" stepKey="enterHeadingTitle">
            <argument name="property" value="PageBuilderHeadingTextProperty"/>
        </actionGroup>
        <actionGroup ref="saveEditPanelSettings" stepKey="saveEditPanelSettings"/>
        <waitForElementVisible selector="{{HeadingOnStage.base(PageBuilderHeadingTypeProperty_H2.value, '1')}}" stepKey="validateHeading1"/>
        <!-- Click Remove Then Cancel In Modal -->
        <comment userInput="Click Remove Then Cancel In Modal" stepKey="commentCancel"/>
        <actionGroup ref="removeEmptyContentTypeFromStage" stepKey="removeHeading">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <waitForPageLoad stepKey="waitForPageLoad"/>
        <waitForElementVisible time="10" selector="{{PageBuilderStage.modal}}" stepKey="waitForModalVisible"/>
        <waitForElementVisible time="10" selector="{{PageBuilderStage.modalCancel}}" stepKey="waitForCancelButton"/>
        <click selector="{{PageBuilderStage.modalCancel}}" stepKey="clickCancelButton"/>
        <waitForPageLoad stepKey="waitForPageLoad2"/>
        <waitForElementNotVisible time="10" selector="{{PageBuilderStage.modal}}" stepKey="waitForModalGone"/>
        <!-- Verify Heading Still Exists -->
        <comment userInput="Verify Heading Still Exists" stepKey="validateHeading"/>
        <waitForElementVisible selector="{{HeadingOnStage.base(PageBuilderHeadingTypeProperty_H2.value, '1')}}" stepKey="validateHeading2"/>
    </test>
    <test name="XOnRemovalConfirmationModal">
        <annotations>
            <features value="Pagebuilder"/>
            <stories value="Removal Confirmation Modal"/>
            <title value="Click X On Removal Confirmation Modal"/>
            <description value="The user should be able to click on the 'X' button in removal confirmation modal and not have content removed."/>
            <severity value="CRITICAL"/>
            <useCaseId value="MAGETWO-87059"/>
            <testCaseId value="MAGETWO-91321"/>
            <group value="pagebuilder"/>
            <group value="pagebuilder-common"/>
            <group value="pagebuilder-heading"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
            <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
        </before>
        <after>
            <actionGroup ref="logout" stepKey="logout"/>
        </after>
        <!-- Add Heading -->
        <comment userInput="Add Heading" stepKey="commentAddHeading"/>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragContentTypeToStage">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <actionGroup ref="clickOutsideLiveEditHeading" stepKey="clickOutsideLiveEditHeading">
            <argument name="index" value="1"/>
        </actionGroup>
        <!-- Configure Heading -->
        <comment userInput="Configure Heading" stepKey="commentEditHeading"/>
        <actionGroup ref="openPageBuilderEditPanel" stepKey="openEditMenuOnStage">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <actionGroup ref="selectSlideOutPanelFieldGeneral" stepKey="enterHeadingType">
            <argument name="property" value="PageBuilderHeadingTypeProperty_H2"/>
        </actionGroup>
        <actionGroup ref="fillSlideOutPanelFieldGeneral" stepKey="enterHeadingTitle">
            <argument name="property" value="PageBuilderHeadingTextProperty"/>
        </actionGroup>
        <actionGroup ref="saveEditPanelSettings" stepKey="saveEditPanelSettings"/>
        <waitForElementVisible selector="{{HeadingOnStage.base(PageBuilderHeadingTypeProperty_H2.value, '1')}}" stepKey="validateHeading1"/>
        <!-- Click Remove Then X In Modal -->
        <comment userInput="Click Remove Then X In Modal" stepKey="commentX"/>
        <actionGroup ref="removeEmptyContentTypeFromStage" stepKey="removeHeading">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <waitForPageLoad stepKey="waitForPageLoad"/>
        <waitForElementVisible time="10" selector="{{PageBuilderStage.modal}}" stepKey="waitForModalVisible"/>
        <waitForElementVisible time="10" selector="{{PageBuilderStage.modalX}}" stepKey="waitForXButton"/>
        <click selector="{{PageBuilderStage.modalX}}" stepKey="clickXButton"/>
        <waitForPageLoad stepKey="waitForPageLoad2"/>
        <waitForElementNotVisible time="10" selector="{{PageBuilderStage.modal}}" stepKey="waitForModalGone"/>
        <!-- Verify Heading Still Exists -->
        <comment userInput="Verify Heading Still Exists" stepKey="validateHeading"/>
        <waitForElementVisible selector="{{HeadingOnStage.base(PageBuilderHeadingTypeProperty_H2.value, '1')}}" stepKey="validateHeading2"/>
    </test>
    <test name="LoginCycleResetsRemoveConfirmationDismissal">
        <annotations>
            <features value="Pagebuilder"/>
            <stories value="MAGETWO-86799: Deleting Content type/ container from the stage"/>
            <title value="Dismissed confirmation is removed on logout"/>
            <description value="The users choice to not show the confirmation again should be reset on logout"/>
            <severity value="CRITICAL"/>
            <testCaseId value="MC-2392"/>
            <group value="pagebuilder"/>
            <group value="pagebuilder-common"/>
            <group value="pagebuilder-heading"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
            <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
        </before>
        <after>
            <actionGroup ref="logout" stepKey="logout"/>
        </after>
        <!-- Add a single header into the first row -->
        <actionGroup ref="dragContentTypeToStage" stepKey="dragHeaderIntoStage">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <actionGroup ref="clickOutsideLiveEditHeading" stepKey="clickOutsideLiveEditHeading">
            <argument name="index" value="1"/>
        </actionGroup>
        <!-- Configure our heading -->
        <comment userInput="Configure first heading" stepKey="commentFirstHeading"/>
        <actionGroup ref="openPageBuilderEditPanel" stepKey="openEditMenuOnStage">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <actionGroup ref="selectSlideOutPanelFieldGeneral" stepKey="enterHeadingTypePropertyH5">
            <argument name="property" value="PageBuilderHeadingTypeProperty_H5"/>
        </actionGroup>
        <actionGroup ref="fillSlideOutPanelFieldGeneral" stepKey="enterHeadingTitleProperty">
            <argument name="property" value="PageBuilderHeadingTextProperty"/>
        </actionGroup>
        <actionGroup ref="saveEditPanelSettings" stepKey="saveEditPanelSettings"/>

        <!-- Duplicate heading, we shall attempt to remove this after save -->
        <comment userInput="Duplicate initial heading" stepKey="commentDuplicateFirstHeading"/>
        <actionGroup ref="duplicateContentType" stepKey="duplicateHeadingOnce">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>

        <!-- Remove the first heading, check to not receive this warning again -->
        <comment userInput="Remove first heading, validate modal is displayed" stepKey="commentRemoveFirstHeading"/>
        <actionGroup ref="removeEmptyContentTypeFromStage" stepKey="removeFirstHeader">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <waitForElementVisible time="10" selector="{{PageBuilderStage.modal}}" stepKey="waitForModalVisible"/>
        <seeElementInDOM selector="{{PageBuilderStage.modal}}" stepKey="seeModal"/>
        <seeElementInDOM selector="{{PageBuilderStage.modalOk}}" stepKey="seeModalOk" />
        <waitForElementVisible selector="{{PageBuilderStage.modalDoNotShowThisAgain}}" stepKey="waitForDoNotShowThisAgain"/>
        <click selector="{{PageBuilderStage.modalDoNotShowThisAgain}}" stepKey="clickDoNotShowThisAgain"/>
        <actionGroup ref="confirmRemovalModal" stepKey="confirmRemoval"/>
        <wait time="2" stepKey="waitForRemovalModal" />

        <!-- Attempt to remove secondary heading, no modal should appear even though it's configured -->
        <comment userInput="Remove second heading, validate modal is not displayed" stepKey="commentRemoveSecondHeading"/>
        <actionGroup ref="removeEmptyContentTypeFromStage" stepKey="removeSecondHeader">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <dontSee selector="{{PageBuilderStage.modal}}" stepKey="dontSeeModalHeader"/>
        <dontSee selector="{{PageBuilderStage.modalOk}}" stepKey="dontSeeModalOkHeader" />

        <!-- Validate the items are removed -->
        <dontSeeElement selector="{{PageBuilderStage.contentTypeInStage(PageBuilderHeadingContentType.role)}}" stepKey="dontSeeHeaderInStage"/>

        <!-- Logout, then login -->
        <comment userInput="Complete a login cycle" stepKey="commentLoginCycle"/>
        <amOnPage url="admin/admin/auth/logout" stepKey="amOnLogoutPage"/>
        <waitForPageLoad stepKey="waitForAdminLoginPageLoad"/>
        <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
        <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
        <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>

        <!-- Add a single header into the first row -->
        <comment userInput="Add a heading to the stage" stepKey="commentAddHeading"/>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragThirdHeaderIntoStage">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <actionGroup ref="clickOutsideLiveEditHeading" stepKey="clickOutsideLiveEditHeadingAgain">
            <argument name="index" value="1"/>
        </actionGroup>
        <!-- Configure our heading -->
        <comment userInput="Configure new heading" stepKey="commentConfigureHeading"/>
        <actionGroup ref="openPageBuilderEditPanel" stepKey="openEditMenuOnStage2">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <actionGroup ref="selectSlideOutPanelFieldGeneral" stepKey="enterHeadingTypePropertyH52">
            <argument name="property" value="PageBuilderHeadingTypeProperty_H5"/>
        </actionGroup>
        <actionGroup ref="fillSlideOutPanelFieldGeneral" stepKey="enterHeadingTitleProperty2">
            <argument name="property" value="PageBuilderHeadingTextProperty"/>
        </actionGroup>
        <actionGroup ref="saveEditPanelSettings" stepKey="saveEditPanelSettings2"/>

        <!-- Remove the heading, we should receive the warning again -->
        <comment userInput="Remove the third heading, see modal" stepKey="commentRemoveThirdHeading"/>
        <actionGroup ref="removeEmptyContentTypeFromStage" stepKey="removeThirdHeader">
            <argument name="contentType" value="PageBuilderHeadingContentType"/>
        </actionGroup>
        <waitForElementVisible time="10" selector="{{PageBuilderStage.modal}}" stepKey="waitForModalVisible2"/>
        <seeElementInDOM selector="{{PageBuilderStage.modal}}" stepKey="seeModal2"/>
        <seeElementInDOM selector="{{PageBuilderStage.modalOk}}" stepKey="seeModalOk2" />
        <actionGroup ref="confirmRemovalModal" stepKey="confirmRemoval2"/>
        <wait time="2" stepKey="waitForRemovalModal1" />

        <!-- Validate the items are removed -->
        <dontSeeElement selector="{{PageBuilderStage.contentTypeInStage(PageBuilderHeadingContentType.role)}}" stepKey="dontSeeHeaderInStage2"/>
    </test>
</tests>
