<?xml version="1.0" encoding="UTF-8"?>
<!--
 /**
  * Copyright Â© Magento, Inc. All rights reserved.
  * See COPYING.txt for license details.
  */
-->
<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="urn:magento:mftf:Test/etc/testSchema.xsd">
    <test name="BannerCannotHaveInlineWysiwygWidgetAndLinkUrlTest">
        <annotations>
            <features value="PageBuilder"/>
            <stories value="Banner"/>
            <title value="Banner inline WYSIWYG editor will notify user that they cannot add TinyMCE Widget and Link URL at the same time"/>
            <description value="Banner edit form and inline editor validate banner TinyMCE Widget and Link URL could not be added at the same time."/>
            <severity value="MAJOR"/>
            <useCaseId value="MC-419"/>
            <testCaseId value="MC-542"/>
            <group value="pagebuilder"/>
            <group value="pagebuilder-banner"/>
            <group value="pagebuilder-bannerCommon"/>
        </annotations>
        <before>
            <actionGroup ref="AdminLoginActionGroup" stepKey="loginAsAdmin"/>
            <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
            <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
            <createData entity="_defaultCmsPage" stepKey="createCMSPageA"/>
        </before>
        <after>
            <deleteData createDataKey="createCMSPageA" stepKey="deletePreReqCMSPageA"/>
            <actionGroup ref="AdminLogoutActionGroup" stepKey="logout"/>
        </after>
        <actionGroup ref="addPageBuilderPageTitle" stepKey="enterPageTitle">
            <argument name="contentType" value="PageBuilderBannerContentType"/>
        </actionGroup>
        <actionGroup ref="expandPageBuilderPanelMenuSection" stepKey="expandPageBuilderPanelMenuSection">
            <argument name="contentType" value="PageBuilderBannerContentType"/>
        </actionGroup>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragBannerIntoStage">
            <argument name="contentType" value="PageBuilderBannerContentType"/>
        </actionGroup>
        <actionGroup ref="openPageBuilderEditPanel" stepKey="openEditMenuOnStage">
            <argument name="contentType" value="PageBuilderBannerContentType"/>
        </actionGroup>
        <!-- Fill Out Edit Panel Link Url property -->
        <actionGroup ref="fillSlideOutPanelLinkUrlField" stepKey="enterLink">
            <argument name="property" value="PageBuilderBannerLinkUrlProperty"/>
            <argument name="selection" value="{{ExternalLink.url}}"/>
            <argument name="newTab" value="PageBuilderBannerNewTabProperty"/>
        </actionGroup>
        <!-- Check Invalid Link Url and Message Text Widget -->
        <comment userInput="Check Invalid Link Url and Message Text Widget" stepKey="commentCheckInvalidLinkUrlAndMessageTextWidget"/>
        <!-- Add Widget to WYSIWYG -->
        <comment userInput="Add Widget to WYSIWYG" stepKey="commentAddPageLinkWidgetToTinyMCE"/>
        <actionGroup ref="addPageLinkWidgetToTinyMCE" stepKey="addPageLinkWidgetToTinyMCE">
            <argument name="widget" value="TinyMCEWidgetCMSPageLink"/>
            <argument name="page" value="$$createCMSPageA.identifier$$"/>
        </actionGroup>
        <actionGroup ref="saveEditPanelAndValidateFieldError" stepKey="validateInvalidLinkUrlAndWidget">
            <argument name="property" value="PageBuilderBannerLinkUrlInvalidWidgetProperty"/>
        </actionGroup>
        <actionGroup ref="saveEditPanelAndValidateFieldError" stepKey="validateInvalidMessageWithWidget">
            <argument name="property" value="PageBuilderBannerMessageInvalidWidgetProperty"/>
        </actionGroup>
        <!-- Check Invalid Link Url and Message Text Link -->
        <comment userInput="Check Invalid Link Url and Message Text Link" stepKey="commentCheckInvalidLinkUrlAndMessageTextLink"/>
        <!-- Add Link to WYSIWYG -->
        <comment userInput="Add Link to WYSIWYG" stepKey="commentAddLink"/>
        <actionGroup ref="insertLinkInWYSIWYG" stepKey="insertLinkInWYSIWYG">
            <argument name="url" value="{{ExternalLink.googleUrl}}"/>
            <argument name="textToDisplay" value="{{ExternalLink.googleUrl}}"/>
        </actionGroup>
        <actionGroup ref="saveEditPanelAndValidateFieldError" stepKey="validateInvalidLinkUrl">
            <argument name="property" value="PageBuilderBannerLinkUrlInvalidProperty"/>
        </actionGroup>
        <actionGroup ref="saveEditPanelAndValidateFieldError" stepKey="validateInvalidMessageWithUrl">
            <argument name="property" value="PageBuilderBannerMessageInvalidProperty"/>
        </actionGroup>
        <!-- Correcting invalid fields -->
        <comment userInput="Correcting invalid fields" stepKey="commentCorrectingInvalidFields"/>
        <actionGroup ref="replaceTextToTinyMCE" stepKey="replaceMessageText">
            <argument name="property" value="PageBuilderBannerMessageProperty"/>
            <argument name="section" value="BannerOnConfigurationPanel"/>
        </actionGroup>
        <actionGroup ref="saveEditPanelSettings" stepKey="saveEditPanelSettings"/>
        <!-- Check inline editor will validate for not allowing TinyMCE Widget and Link URL at the same time -->
        <comment userInput="Check inline editor will validate for not allowing TinyMCE Widget and Link URL at the same time" stepKey="commentCheckInlineEditorPreventAddingWidgetAndLinkUrl"/>
        <click selector="{{PageBuilderStage.inlineWYSIWYGEditor(PageBuilderBannerContentType.role, '1')}}" stepKey="focusOnEditorArea"/>
        <waitForElementVisible selector="{{PageBuilderStage.inlineWYSIWYGEditorPanel(PageBuilderBannerContentType.role, '1')}}" stepKey="waitForEditorPanel"/>
        <!-- Add Widget to WYSIWYG in Stage Inline Editor -->
        <comment userInput="Add Widget to WYSIWYG in Stage Inline Editor" stepKey="commentaddPageLinkWidgetToTinyMCEInline"/>
        <actionGroup ref="addPageLinkWidgetToTinyMCEInline" stepKey="addPageLinkWidgetToTinyMCEInline">
            <argument name="widget" value="TinyMCEWidgetCMSPageLink"/>
            <argument name="page" value="$$createCMSPageA.identifier$$"/>
        </actionGroup>
        <seeElement selector="{{PageBuilderStage.modal(PageBuilderBannerMessageInvalidWidgetProperty.stageErrorMessage)}}" stepKey="seeCorrectErrorModal"/>
        <actionGroup ref="confirmRemovalModal" stepKey="confirmNestingLinkModal"/>
        <!-- Checks for Widget Placeholder within the tinyMCE with regex -->
        <executeJS function="return (/&lt;span.*(class=)(&quot;|\').*((magento-placeholder).*(magento-widget)|(magento-widget).*(magento-placeholder)).*&lt;\/span&gt;/igm).test(tinymce.activeEditor.getContent());" stepKey="grabIfWidgetInWysiwygBoolean"/>
        <assertFalse stepKey="assertMessageHasNoWidgets">
            <actualResult type="variable">grabIfWidgetInWysiwygBoolean</actualResult>
        </assertFalse>
        <!-- Check inline editor will validate for not allowing TinyMCE Link and Link URL at the same time -->
        <comment userInput="Check inline editor will validate for not allowing TinyMCE Link and Link URL at the same time" stepKey="commentCheckInlineEditorPreventAddingBothUrls"/>
        <click selector="{{PageBuilderStage.inlineWYSIWYGEditor(PageBuilderBannerContentType.role, '1')}}" stepKey="focusOnEditorArea2"/>
        <waitForElementVisible selector="{{PageBuilderStage.inlineWYSIWYGEditorPanel(PageBuilderBannerContentType.role, '1')}}" stepKey="waitForEditorPanel2"/>
        <!-- Add Link to WYSIWYG in Stage Inline Editor -->
        <comment userInput="Add Link to WYSIWYG in Stage Inline Editor" stepKey="commentInsertLinkInStageInlineEditor"/>
        <actionGroup ref="insertLinkInWYSIWYG" stepKey="insertLinkInStageInlineEditor">
            <argument name="url" value="{{ExternalLink.googleUrl}}"/>
            <argument name="textToDisplay" value="{{ExternalLink.googleUrl}}"/>
            <argument name="wysiwygArea" value=""/>
        </actionGroup>
        <seeElement selector="{{PageBuilderStage.modal(PageBuilderBannerMessageInvalidProperty.stageErrorMessage)}}" stepKey="seeCorrectErrorModal2"/>
        <actionGroup ref="confirmRemovalModal" stepKey="confirmNestingLinkModal2"/>
        <!-- Checks for a tags within the tinyMCE with regex -->
        <executeJS function="return (/&lt;a[\s]+([^&gt;]+)&gt;|&lt;a&gt;|&lt;\/a&gt;/igm).test(tinymce.activeEditor.getContent());" stepKey="grabIfAnchorInWysiwygBoolean"/>
        <assertFalse stepKey="assertMessageHasNoAnchorTags">
            <actualResult type="variable">grabIfAnchorInWysiwygBoolean</actualResult>
        </assertFalse>
        <!-- Check slide out editor will validate for not allowing TinyMCE Widget and Link URL at the same time -->
        <comment userInput="Check slide out editor will validate for not allowing TinyMCE Widget and Link URL at the same time" stepKey="commentCheckSlideOutEditorPreventAddingWidgetAndLinkUrl"/>
        <click selector="{{PageBuilderPanel.searchPanel}}" stepKey="unFocusEditor"/>
        <actionGroup ref="openPageBuilderEditPanel" stepKey="openEditMenuOnStageAfterInlineValidation">
            <argument name="contentType" value="PageBuilderBannerContentType"/>
        </actionGroup>
        <!-- Checks for a tags within the tinyMCE with regex -->
        <executeJS function="return (/&lt;span.*(class=)(&quot;|\').*((magento-placeholder).*(magento-widget)|(magento-widget).*(magento-placeholder)).*&lt;\/span&gt;/igm).test(tinymce.activeEditor.getContent());" stepKey="grabIfWidgetInSlideOutWysiwygBoolean"/>
        <assertFalse stepKey="assertMessageHasNoWidgets2">
            <actualResult type="variable">grabIfWidgetInSlideOutWysiwygBoolean</actualResult>
        </assertFalse>
        <actionGroup ref="saveEditPanelSettings" stepKey="saveEditPanelSettings2"/>
        <!-- Check slide out editor will validate for not allowing TinyMCE Link and Link URL at the same time -->
        <comment userInput="Check slide out editor will validate for not allowing TinyMCE Link and Link URL at the same time" stepKey="commentCheckSlideOutEditorPreventAddingBothUrls"/>
        <click selector="{{PageBuilderPanel.searchPanel}}" stepKey="unFocusEditor2"/>
        <actionGroup ref="openPageBuilderEditPanel" stepKey="openEditMenuOnStageAfterInlineValidation2">
            <argument name="contentType" value="PageBuilderBannerContentType"/>
        </actionGroup>
        <!-- Checks for a tags within the tinyMCE with regex -->
        <executeJS function="return (/&lt;a[\s]+([^&gt;]+)&gt;|&lt;a&gt;|&lt;\/a&gt;/igm).test(tinymce.activeEditor.getContent());" stepKey="grabIfAnchorInSlideOutWysiwygBoolean"/>
        <assertFalse stepKey="assertMessageHasNoAnchorTags2">
            <actualResult type="variable">grabIfAnchorInSlideOutWysiwygBoolean</actualResult>
        </assertFalse>
        <actionGroup ref="saveEditPanelSettings" stepKey="saveEditPanelSettings3"/>
        <actionGroup ref="SaveAndContinueEditCmsPageActionGroup" stepKey="saveAndContinueEditCmsPage"/>
        <!-- Storefront: Validate No Widgets And No Link in Banner Content -->
        <comment userInput="Storefront: Validate No Link in Banner Content" stepKey="CommentValidateNoLinkInBannerContent"/>
        <actionGroup ref="navigateToStoreFront" stepKey="navigateToStoreFront">
            <argument name="contentType" value="PageBuilderBannerContentType"/>
        </actionGroup>
        <!-- Checks for Widget Block within the message with regex -->
        <executeJS function="return (/&lt;div.*(class=)(&quot;|\').*((widget).*(block)|(block).*(widget)).*&lt;\/div&gt;/igm).test({{BannerOnFrontend.contentJS('1')}}.innerHTML);" stepKey="grabIfFrontendWidgetBlockInContentBoolean"/>
        <assertFalse stepKey="assertFrontendMessageHasNoWidgetBlock">
            <actualResult type="variable">grabIfFrontendWidgetBlockInContentBoolean</actualResult>
        </assertFalse>
        <!-- Checks for a tags within the message with regex -->
        <executeJS function="return (/&lt;a[\s]+([^&gt;]+)&gt;|&lt;a&gt;|&lt;\/a&gt;/igm).test({{BannerOnFrontend.contentJS('1')}}.innerHTML);" stepKey="grabIfFrontendAnchorInContentBoolean"/>
        <assertFalse stepKey="assertFrontendMessageHasNoAnchorTags">
            <actualResult type="variable">grabIfFrontendAnchorInContentBoolean</actualResult>
        </assertFalse>
    </test>
</tests>