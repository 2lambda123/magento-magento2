<?xml version="1.0" encoding="UTF-8"?>
<!--
 /**
  * Copyright Â© Magento, Inc. All rights reserved.
  * See COPYING.txt for license details.
  */
-->

<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:noNamespaceSchemaLocation="../../../../../../../dev/tests/acceptance/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Test/etc/testSchema.xsd">
    <test name="ValidateGridDefaultSizeOnStage">
        <annotations>
            <features value="Pagebuilder"/>
            <stories value="Column"/>
            <title value="Verify default grid size"/>
            <description value="Verify the default grid size (12) is set correctly within the stage."/>
            <severity value="CRITICAL"/>
            <testCaseId value="MC-2280"/>
            <group value="pagebuilder"/>
            <group value="pagebuilder-column"/>
            <group value="pagebuilder-columnGridSize"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
            <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
        </before>
        <after>
            <actionGroup ref="logout" stepKey="logOut"/>
        </after>
        <actionGroup ref="addPageBuilderPageTitle" stepKey="enterPageTitle">
            <argument name="contentType" value="PageBuilderColumnContentType"/>
        </actionGroup>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragColumnIntoStage">
            <argument name="contentType" value="PageBuilderColumnContentType"/>
        </actionGroup>
        <comment userInput="Validate default grid size on initial drop" stepKey="commentValidateInitial"/>
        <actionGroup ref="openGridSizeForm" stepKey="openGridSizeForm" />
        <seeInField selector="{{PageBuilderColumnSection.gridSizeInput}}" userInput="{{PageBuilderGridSize.defaultGridSize}}" stepKey="seeDefaultGridSize"/>
        <actionGroup ref="saveAndContinueEditCmsPage" stepKey="saveAndContinueEditCmsPage"/>
        <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
        <comment userInput="Validate default grid size after save" stepKey="commentValidateAfterSave"/>
        <actionGroup ref="openGridSizeForm" stepKey="openGridSizeFormAfterSave" />
        <seeInField selector="{{PageBuilderColumnSection.gridSizeInput}}" userInput="{{PageBuilderGridSize.defaultGridSize}}" stepKey="seeDefaultGridSizeAfterSave"/>
    </test>
    <test name="ValidateGridInputFocusedOnOpen">
        <annotations>
            <features value="Pagebuilder"/>
            <stories value="Column"/>
            <title value="Verify input is auto focused"/>
            <description value="Verify when the grid form is opened the field is focused"/>
            <severity value="CRITICAL"/>
            <testCaseId value="MC-2281"/>
            <group value="pagebuilder"/>
            <group value="pagebuilder-column"/>
            <group value="pagebuilder-columnGridSize"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
            <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
        </before>
        <after>
            <actionGroup ref="logout" stepKey="logOut"/>
        </after>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragColumnIntoStage">
            <argument name="contentType" value="PageBuilderColumnContentType"/>
        </actionGroup>
        <comment userInput="Validate input is focused" stepKey="commentValidateInitial"/>
        <actionGroup ref="openGridSizeForm" stepKey="openGridSizeForm" />
        <executeJS function="return window.getSelection().toString();" stepKey="getSelectedTextFromWindow"/>
        <assertEquals stepKey="assertSelectionIsDefaultGridSize">
            <expectedResult type="variable">getSelectedTextFromWindow</expectedResult>
            <actualResult type="string">{{PageBuilderGridSize.defaultGridSize}}</actualResult>
        </assertEquals>
    </test>
    <test name="SetDefaultGridSize14">
        <annotations>
            <features value="Pagebuilder"/>
            <stories value="Column"/>
            <title value="Set the grid size to 14"/>
            <description value="Set the grid size to 14 and validate columns width doesn't change"/>
            <severity value="CRITICAL"/>
            <testCaseId value="MC-2281"/>
            <group value="pagebuilder"/>
            <group value="pagebuilder-column"/>
            <group value="pagebuilder-columnGridSize"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
            <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
        </before>
        <after>
            <actionGroup ref="logout" stepKey="logOut"/>
        </after>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragColumnIntoStage">
            <argument name="contentType" value="PageBuilderColumnContentType"/>
        </actionGroup>
        <executeJS function="return document.querySelector('{{PageBuilderColumnSection.columnX('1')}}').clientWidth" stepKey="columnOneWidthGrid12"/>
        <executeJS function="return document.querySelector('{{PageBuilderColumnSection.columnX('2')}}').clientWidth" stepKey="columnTwoWidthGrid12"/>
        <actionGroup ref="updateGridSize" stepKey="updateGridSizeTo14">
            <argument name="gridSize" value="14"/>
        </actionGroup>
        <executeJS function="return document.querySelector('{{PageBuilderColumnSection.columnX('1')}}').clientWidth" stepKey="columnOneWidthGrid14"/>
        <executeJS function="return document.querySelector('{{PageBuilderColumnSection.columnX('2')}}').clientWidth" stepKey="columnTwoWidthGrid14"/>
        <comment userInput="Validate first column unchanged" stepKey="commentValidateFirstCommentUnchanged"/>
        <assertEquals stepKey="assertFirstColumnsWidth">
            <expectedResult type="variable">columnOneWidthGrid12</expectedResult>
            <actualResult type="variable">columnOneWidthGrid14</actualResult>
        </assertEquals>
        <comment userInput="Validate second column unchanged" stepKey="commentValidateSecondCommentUnchanged"/>
        <assertEquals stepKey="assertSecondColumnsWidth">
            <expectedResult type="variable">columnTwoWidthGrid12</expectedResult>
            <actualResult type="variable">columnTwoWidthGrid14</actualResult>
        </assertEquals>
    </test>
    <test name="SetDefaultGridSize7">
        <annotations>
            <features value="Pagebuilder"/>
            <stories value="Column"/>
            <title value="Set the grid size to 7"/>
            <description value="Set the grid size to 14 and validate columns adjust to fit new grid size"/>
            <severity value="CRITICAL"/>
            <testCaseId value="MC-2283"/>
            <group value="pagebuilder"/>
            <group value="pagebuilder-column"/>
            <group value="pagebuilder-columnGridSize"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
            <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
        </before>
        <after>
            <actionGroup ref="logout" stepKey="logOut"/>
        </after>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragColumnIntoStage">
            <argument name="contentType" value="PageBuilderColumnContentType"/>
        </actionGroup>
        <executeJS function="return document.querySelector('{{PageBuilderColumnSection.columnX('1')}}').clientWidth" stepKey="columnOneWidthGrid12"/>
        <executeJS function="return document.querySelector('{{PageBuilderColumnSection.columnX('2')}}').clientWidth" stepKey="columnTwoWidthGrid12"/>
        <actionGroup ref="updateGridSize" stepKey="updateGridSizeTo14">
            <argument name="gridSize" value="7"/>
        </actionGroup>
        <executeJS function="return document.querySelector('{{PageBuilderColumnSection.columnX('1')}}').clientWidth" stepKey="columnOneWidthGrid7"/>
        <executeJS function="return document.querySelector('{{PageBuilderColumnSection.columnX('2')}}').clientWidth" stepKey="columnTwoWidthGrid7"/>
        <comment userInput="Validate first column grew larger" stepKey="commentValidateFirstCommentUnchanged"/>
        <assertGreaterThan stepKey="assertOriginalWidthGreaterThanNewWidth">
            <expectedResult type="variable">columnOneWidthGrid12</expectedResult>
            <actualResult type="variable">columnOneWidthGrid7</actualResult>
        </assertGreaterThan>
        <comment userInput="Validate second column shrunk" stepKey="commentValidateSecondCommentUnchanged"/>
        <assertLessThan stepKey="assertOriginalWidthLessThanNewWidth">
            <expectedResult type="variable">columnTwoWidthGrid12</expectedResult>
            <actualResult type="variable">columnTwoWidthGrid7</actualResult>
        </assertLessThan>
        <seeElement selector="{{PageBuilderColumnSection.displayLabel('1','4/7')}}" stepKey="checkWidthFirstColumn"/>
        <seeElement selector="{{PageBuilderColumnSection.displayLabel('2','3/7')}}" stepKey="checkWidthSecondColumn"/>
    </test>
    <test name="SetDefaultGridSize1">
        <annotations>
            <features value="Pagebuilder"/>
            <stories value="Column"/>
            <title value="Set the grid size to 1"/>
            <description value="Set grid size to 1 validate empty column is removed and single 100% column persists"/>
            <severity value="CRITICAL"/>
            <testCaseId value="MC-2284"/>
            <group value="pagebuilder"/>
            <group value="pagebuilder-column"/>
            <group value="pagebuilder-columnGridSize"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
            <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
        </before>
        <after>
            <actionGroup ref="logout" stepKey="logOut"/>
        </after>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragColumnIntoStage">
            <argument name="contentType" value="PageBuilderColumnContentType"/>
        </actionGroup>
        <actionGroup ref="updateGridSize" stepKey="updateGridSizeTo1">
            <argument name="gridSize" value="1"/>
        </actionGroup>
        <seeNumberOfElements selector="{{PageBuilderColumnSection.allColumns}}" userInput="1" stepKey="seeNumberOfColumns1"/>
        <seeElement selector="{{PageBuilderColumnSection.displayLabel('1','1/1')}}" stepKey="validateSingleColumnOfFullWidth"/>
    </test>
    <test name="ValidateGridSizeFormDisablesStage">
        <annotations>
            <features value="Pagebuilder"/>
            <stories value="Column"/>
            <title value="Set the grid size to 1"/>
            <description value="Set grid size to 1 validate empty column is removed and single 100% column persists"/>
            <severity value="CRITICAL"/>
            <testCaseId value="MC-2284"/>
            <group value="pagebuilder"/>
            <group value="pagebuilder-column"/>
            <group value="pagebuilder-columnGridSize"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
            <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
        </before>
        <after>
            <actionGroup ref="logout" stepKey="logOut"/>
        </after>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragAdditionalRow">
            <argument name="contentType" value="PageBuilderRowContentType"/>
        </actionGroup>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragColumnIntoStage">
            <argument name="contentType" value="PageBuilderColumnContentType"/>
        </actionGroup>
        <actionGroup ref="openGridSizeForm" stepKey="openGridSizeForm" />
        <comment userInput="Validate column options dont display" stepKey="commentColumnOptionsHidden"/>
        <moveMouseOver selector="{{PageBuilderColumnSection.columnX('2')}}" x="10" y="10" stepKey="moveMouseOverColumn" />
        <waitForPageLoad stepKey="waitForAnimations" />
        <dontSee selector="{{PageBuilderActionsSection.contentTypeOptionsMenuByIndex(PageBuilderColumnContentType.role, '2')}}" stepKey="dontSeeColumnOptions" />
        <waitForElementNotVisible selector="{{PageBuilderActionsSection.contentTypeOptionsMenuByIndex(PageBuilderColumnContentType.role, '2')}}" stepKey="notVisibleColumnOptions" />
        <comment userInput="Validate row options dont display" stepKey="commentRowOptionsHidden"/>
        <moveMouseOver selector="{{PageBuilderActionsSection.contentTypeInStageByIndex(PageBuilderRowContentType.role, '2')}}" x="10" y="10" stepKey="moveMouseOverRow" />
        <waitForPageLoad stepKey="waitForRowAnimations" />
        <dontSee selector="{{PageBuilderActionsSection.contentTypeOptionsMenuByIndex(PageBuilderRowContentType.role, '2')}}" stepKey="dontSeeRowOptions" />
        <comment userInput="Close grid form and check options are restored" stepKey="commentCloseAndValidateOptionsAreRestored"/>
        <actionGroup ref="closeGridSizeForm" stepKey="closeGridForm" />
        <moveMouseOver selector="{{PageBuilderActionsSection.contentTypeInStage(PageBuilderRowContentType.role)}}" x="10" y="0" stepKey="onMouseOverContentTypeStage"/>
        <waitForPageLoad stepKey="waitForPageLoad"/>
        <waitForElementVisible time="10" selector="{{PageBuilderActionsSection.contentTypeOptionsMenu(PageBuilderRowContentType.role)}}" stepKey="waitForOptions"/>
    </test>
    <test name="ValidateUnfocusUpdatesGrid">
        <annotations>
            <features value="Pagebuilder"/>
            <stories value="Column"/>
            <title value="Unfocus updates grid"/>
            <description value="Checks if unfocusing / clicking out of the column group updates the grid size"/>
            <severity value="CRITICAL"/>
            <testCaseId value="MC-2286"/>
            <group value="pagebuilder"/>
            <group value="pagebuilder-column"/>
            <group value="pagebuilder-columnGridSize"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
            <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
        </before>
        <after>
            <actionGroup ref="logout" stepKey="logOut"/>
        </after>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragColumnIntoStage">
            <argument name="contentType" value="PageBuilderColumnContentType"/>
        </actionGroup>
        <actionGroup ref="openGridSizeForm" stepKey="openGridSizeForm" />
        <fillField selector="{{PageBuilderColumnSection.gridSizeInput('1')}}" userInput="8" stepKey="enterGridSize"/>
        <actionGroup ref="closeGridSizeForm" stepKey="closeGridFormByClicking" />
        <waitForElementNotVisible selector="{{PageBuilderColumnSection.gridSizeInput('1')}}" stepKey="waitForGridFormNotVisible" />
        <seeElement selector="{{PageBuilderColumnSection.displayLabel('1','4/8')}}" stepKey="checkWidthFirstColumn"/>
        <seeElement selector="{{PageBuilderColumnSection.displayLabel('2','4/8')}}" stepKey="checkWidthSecondColumn"/>
    </test>
    <test name="ValidateEmptyColumnsDeletedOnSmallerGridSize">
        <annotations>
            <features value="Pagebuilder"/>
            <stories value="Column"/>
            <title value="Set grid size smaller to remove column"/>
            <description value="Check if empty columns will be deleted when reducing the grid size under the amount of columns"/>
            <severity value="CRITICAL"/>
            <testCaseId value="MC-2287"/>
            <group value="pagebuilder"/>
            <group value="pagebuilder-column"/>
            <group value="pagebuilder-columnGridSize"/>
            <group value="pagebuilder-divider"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <actionGroup ref="navigateToAPageWithPageBuilder" stepKey="navigateToAPageWithPageBuilder"/>
            <actionGroup ref="switchToPageBuilderStage" stepKey="switchToPageBuilderStage"/>
        </before>
        <after>
            <actionGroup ref="logout" stepKey="logOut"/>
        </after>
        <actionGroup ref="dragContentTypeToStage" stepKey="dragColumnIntoStage">
            <argument name="contentType" value="PageBuilderColumnContentType"/>
        </actionGroup>
        <actionGroup ref="dragContentTypeToContainer" stepKey="dragIntoStage">
            <argument name="contentType" value="PageBuilderDividerContentType"/>
            <argument name="containerTargetType" value="PageBuilderColumnContentType"/>
        </actionGroup>
        <actionGroup ref="duplicateContentType" stepKey="duplicateColumn">
            <argument name="contentType" value="PageBuilderColumnContentType"/>
            <argument name="targetIndex" value="1"/>
            <argument name="expectedIndex" value="2"/>
        </actionGroup>
        <actionGroup ref="duplicateContentType" stepKey="duplicateColumn2">
            <argument name="contentType" value="PageBuilderColumnContentType"/>
            <argument name="targetIndex" value="1"/>
            <argument name="expectedIndex" value="2"/>
        </actionGroup>
        <seeNumberOfElements selector="{{PageBuilderColumnSection.allColumns}}" userInput="4" stepKey="seeNumberOfColumns4"/>
        <actionGroup ref="updateGridSize" stepKey="updateGridSizeTo1">
            <argument name="gridSize" value="3"/>
        </actionGroup>
        <seeNumberOfElements selector="{{PageBuilderColumnSection.allColumns}}" userInput="3" stepKey="seeNumberOfColumns3"/>
    </test>
    <test name="ValidateDefaultAndMaxGridSizesInSystemConfig">
        <annotations>
            <features value="Pagebuilder"/>
            <stories value="Column"/>
            <title value="Verify the default grid size and max size in system config"/>
            <description value="Verify the default grid size and max size in system config"/>
            <severity value="CRITICAL"/>
            <testCaseId value="MC-2291"/>
            <group value="run"/>
            <group value="pagebuilder-column"/>
            <group value="pagebuilder-columnGridSize"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
        </before>
        <after>
            <actionGroup ref="logout" stepKey="logout"/>
        </after>
        <actionGroup ref="navigateToAdminContentManagementPage" stepKey="navigateToAdminContentManagementPage"/>
        <conditionalClick stepKey="expandAdvancedContentTools" selector="{{ContentManagementSection.PageBuilderOptions}}" dependentSelector="{{ContentManagementSection.CheckIfPageBuilderTabExpanded}}" visible="true"/>
        <!-- see correct default grid size and max size -->
        <seeInField selector="{{ContentManagementSection.ColumnGridDefaultInputField}}" userInput="{{PageBuilderGridSize.defaultGridSize}}" stepKey="seeDefaultGridSize"/>
        <seeInField selector="{{ContentManagementSection.ColumnGridMaxInputField}}" userInput="{{PageBuilderGridSize.defaultMaxGridSize}}" stepKey="seeMaxGridSize"/>
    </test>
    <test name="ValidateGridSettingsValidationInSystemConfig">
        <annotations>
            <features value="Pagebuilder"/>
            <stories value="Column"/>
            <title value="Verify you cannot set the grid default size higher than the max size."/>
            <description value="Verify you cannot set the grid default size higher than the max size."/>
            <severity value="CRITICAL"/>
            <testCaseId value="MC-2293"/>
            <group value="run"/>
            <group value="pagebuilder-column"/>
            <group value="pagebuilder-columnGridSize"/>
        </annotations>
        <before>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
        </before>
        <after>
            <actionGroup ref="logout" stepKey="logout"/>
        </after>
        <actionGroup ref="navigateToAdminContentManagementPage" stepKey="navigateToAdminContentManagementPage"/>
        <conditionalClick stepKey="expandAdvancedContentTools" selector="{{ContentManagementSection.PageBuilderOptions}}" dependentSelector="{{ContentManagementSection.CheckIfPageBuilderTabExpanded}}" visible="true"/>
        <!-- enter invalid default grid size -->
        <actionGroup ref="updateDefaultGridSizeConfig" stepKey="enterInvalidDefaultGridSize">
            <argument name="gridSize" value="{{PageBuilderGridSize.gridSize_50}}"/>
        </actionGroup>
        <actionGroup ref="saveStoreConfiguration" stepKey="saveStoreConfiguration1"/>
        <waitForElementVisible selector="{{ContentManagementSection.ColumnGridDefaultInputFieldError}}" stepKey="waitForInvalidDefaultGridSizeErrorMessage"/>
        <see selector="{{ContentManagementSection.ColumnGridDefaultInputFieldError}}" userInput="{{PageBuilderGridSize.invalidDefaultGridSizeErrorMessage}}" stepKey="seeInvalidDefaultGridSizeErrorMessage"/>
        <!-- enter valid default grid size -->
        <actionGroup ref="updateDefaultGridSizeConfig" stepKey="enterValidDefaultGridSize">
            <argument name="gridSize" value="{{PageBuilderGridSize.gridSize_6}}"/>
        </actionGroup>
        <actionGroup ref="saveStoreConfiguration" stepKey="saveStoreConfiguration2"/>
        <see selector="{{ContentManagementSection.StoreConfigurationPageSuccessMessage}}" userInput="You saved the configuration." stepKey="seeSuccessMessage1"/>
        <!-- enter invalid max grid size -->
        <actionGroup ref="updateMaxGridSizeConfig" stepKey="enterInvalidMaxGridSize">
            <argument name="gridSize" value="{{PageBuilderGridSize.gridSize_3}}"/>
        </actionGroup>
        <actionGroup ref="saveStoreConfiguration" stepKey="saveStoreConfiguration3"/>
        <waitForElementVisible selector="{{ContentManagementSection.ColumnGridDefaultInputFieldError}}" stepKey="waitForInvalidMaxGridSizeErrorMessage"/>
        <see selector="{{ContentManagementSection.ColumnGridDefaultInputFieldError}}" userInput="{{PageBuilderGridSize.invalidDefaultGridSizeErrorMessage}}" stepKey="seeInvalidMaxGridSizeErrorMessage"/>
        <!-- enter valid max grid size -->
        <actionGroup ref="updateMaxGridSizeConfig" stepKey="enterValidMaxGridSize">
            <argument name="gridSize" value="{{PageBuilderGridSize.gridSize_32}}"/>
        </actionGroup>
        <actionGroup ref="saveStoreConfiguration" stepKey="saveStoreConfiguration4"/>
        <see selector="{{ContentManagementSection.StoreConfigurationPageSuccessMessage}}" userInput="You saved the configuration." stepKey="seeSuccessMessage2"/>
        <!-- restore default values -->
        <actionGroup ref="updateDefaultGridSizeConfig" stepKey="restoreDefaultGridSize"/>
        <actionGroup ref="updateMaxGridSizeConfig" stepKey="restoreDefaultMaxGridSize"/>
        <actionGroup ref="saveStoreConfiguration" stepKey="saveStoreConfiguration5"/>
        <see selector="{{ContentManagementSection.StoreConfigurationPageSuccessMessage}}" userInput="You saved the configuration." stepKey="seeSuccessMessage3"/>
    </test>
</tests>
